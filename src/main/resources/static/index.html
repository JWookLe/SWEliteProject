<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²°ì œ MSA í…ŒìŠ¤íŠ¸ ì½˜ì†”</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/inter@5.0.1/variable.css"
    />
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'InterVariable', -apple-system, BlinkMacSystemFont, 'Segoe UI',
          sans-serif;
        background-color: #f5f7fb;
        color: #1f2937;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(135deg, #eef2ff 0%, #fdf2f8 100%);
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 3rem 1.5rem 4rem;
      }

      header {
        text-align: center;
        margin-bottom: 2.5rem;
      }

      header h1 {
        margin: 0;
        font-size: 2.5rem;
        font-weight: 700;
        color: #111827;
      }

      header p {
        margin: 0.75rem auto 0;
        max-width: 720px;
        line-height: 1.6;
        color: #4b5563;
      }

      .service-grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        margin-bottom: 2.5rem;
      }

      .service-card {
        border-radius: 16px;
        border: 1px solid rgba(99, 102, 241, 0.12);
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(6px);
        box-shadow: 0 16px 40px rgba(79, 70, 229, 0.08);
        transition: transform 150ms ease, box-shadow 150ms ease;
        padding: 1.75rem;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .service-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 45px rgba(79, 70, 229, 0.12);
      }

      .service-card.active {
        border-color: rgba(79, 70, 229, 0.5);
        box-shadow: 0 20px 45px rgba(79, 70, 229, 0.16);
      }

      .service-card h2 {
        margin: 0;
        font-size: 1.15rem;
        font-weight: 700;
        color: #1f2937;
      }

      .service-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        color: #6366f1;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .service-description {
        margin: 0;
        color: #4b5563;
        line-height: 1.6;
        flex-grow: 1;
      }

      .service-upstream {
        margin: 0;
        font-size: 0.85rem;
        color: #6b7280;
      }

      .panel {
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(15, 23, 42, 0.08);
        box-shadow: 0 18px 38px rgba(15, 23, 42, 0.12);
        padding: 2rem;
      }

      .panel h3 {
        margin-top: 0;
        font-size: 1.5rem;
        color: #111827;
      }

      .endpoints {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      .endpoint-card {
        border-radius: 14px;
        border: 1px solid rgba(99, 102, 241, 0.16);
        padding: 1.5rem;
        background: rgba(249, 250, 251, 0.75);
        display: grid;
        gap: 1rem;
      }

      .endpoint-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.75rem;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      .badge.method {
        background: rgba(59, 130, 246, 0.15);
        color: #1d4ed8;
      }

      .badge.scope {
        background: rgba(16, 185, 129, 0.15);
        color: #047857;
      }

      .path-input {
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        padding: 0.65rem 0.9rem;
        font-size: 0.95rem;
        font-family: 'InterVariable', monospace;
        background: #ffffff;
      }

      textarea {
        min-height: 140px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        padding: 0.9rem 1rem;
        font-size: 0.95rem;
        font-family: 'InterVariable', 'JetBrains Mono', monospace;
        background: #ffffff;
        resize: vertical;
      }

      .endpoint-footer {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .send-button {
        align-self: flex-start;
        background: linear-gradient(135deg, #4f46e5, #9333ea);
        color: white;
        border: none;
        border-radius: 999px;
        padding: 0.75rem 1.5rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
      }

      .send-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 25px rgba(79, 70, 229, 0.3);
      }

      .send-button:disabled {
        opacity: 0.65;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .status-line {
        font-family: 'InterVariable', monospace;
        font-size: 0.9rem;
        color: #1f2937;
      }

      .response-viewer {
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: #0f172a;
        color: #e2e8f0;
        padding: 1rem;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .notes {
        margin: 0;
        color: #6b7280;
        font-size: 0.85rem;
      }

      .env-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .env-bar label {
        font-size: 0.9rem;
        color: #4b5563;
        font-weight: 600;
      }

      .env-input {
        padding: 0.5rem 0.75rem;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: white;
        font-size: 0.9rem;
        font-family: 'InterVariable', monospace;
        width: 260px;
      }

      @media (max-width: 768px) {
        .app-container {
          padding: 2.5rem 1.25rem 3rem;
        }

        header h1 {
          font-size: 2rem;
        }

        .panel {
          padding: 1.5rem;
        }
      }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div class="app-container">
      <div id="root"></div>
    </div>

    <script type="text/babel">
      const { useMemo, useState } = React;

      const SERVICE_CATALOG = [
        {
          id: 'gateway',
          name: 'API Gateway',
          domain: 'edge-service',
          baseUrl: 'http://localhost:8080',
          description:
            'ì™¸ë¶€ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•˜ê³  ê³µí†µ ì¸ì¦/ë¡œê¹…ì„ ë‹´ë‹¹í•˜ëŠ” ì§„ì…ì ì…ë‹ˆë‹¤. ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ í—¬ìŠ¤ ì²´í¬ì™€ SLAë¥¼ í•œ í™”ë©´ì—ì„œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
          upstream: 'Routes â†’ Payment Service, Settlement Service, Notification Service',
          endpoints: [
            {
              id: 'gateway-health',
              label: 'ê²Œì´íŠ¸ì›¨ì´ ìƒíƒœ',
              method: 'GET',
              path: '/actuator/health',
              scope: 'Observability',
              sampleBody: null,
              notes:
                'Spring Boot Actuatorê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ê²Œì´íŠ¸ì›¨ì´ì˜ ìƒíƒœë¥¼ ì¦‰ì‹œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            },
          ],
        },
        {
          id: 'payment',
          name: 'Payment Service',
          domain: 'core-ledger',
          baseUrl: 'http://localhost:8080',
          description:
            'ìŠ¹ì¸/ë§¤ì…/í™˜ë¶ˆ íŠ¸ëœì­ì…˜ì„ ë‹´ë‹¹í•˜ëŠ” ê²°ì œ í•µì‹¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. Outbox íŒ¨í„´ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ì—¬ í›„ì† ì„œë¹„ìŠ¤ì™€ ì—°ë™í•©ë‹ˆë‹¤.',
          upstream: 'Publishes Kafka â†’ Settlement Service, Notify Service',
          endpoints: [
            {
              id: 'authorize',
              label: 'ê²°ì œ ìŠ¹ì¸',
              method: 'POST',
              path: '/payments/authorize',
              scope: 'Command',
              sampleBody: {
                merchantId: 'M100',
                amount: 10000,
                currency: 'KRW',
                idempotencyKey: 'idem-001',
              },
              notes:
                'ë©±ë“±í‚¤(idempotencyKey)ë¥¼ ë³€ê²½í•˜ë©´ì„œ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•˜ì—¬ ì¤‘ë³µ ë°©ì§€ ë¡œì§ì„ ê²€ì¦í•´ ë³´ì„¸ìš”.',
            },
            {
              id: 'capture',
              label: 'ê²°ì œ ë§¤ì…',
              method: 'POST',
              path: '/payments/capture/{paymentId}',
              scope: 'Command',
              sampleBody: {
                merchantId: 'M100',
              },
              notes:
                'ë§¤ì… ì‹œ {paymentId} ê²½ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ìŠ¹ì¸ ì‘ë‹µì—ì„œ ë°›ì€ ê°’ìœ¼ë¡œ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤.',
            },
            {
              id: 'refund',
              label: 'ê²°ì œ í™˜ë¶ˆ',
              method: 'POST',
              path: '/payments/refund/{paymentId}',
              scope: 'Command',
              sampleBody: {
                merchantId: 'M100',
                reason: 'customer cancellation',
              },
              notes:
                'í™˜ë¶ˆì€ ë§¤ì…ì´ ì™„ë£Œëœ ê±´ì— ëŒ€í•´ì„œë§Œ ì„±ê³µí•©ë‹ˆë‹¤. ì‚¬ìœ (reason)ë¥¼ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”.',
            },
          ],
        },
        {
          id: 'settlement',
          name: 'Settlement Service',
          domain: 'batch-ops',
          baseUrl: 'http://localhost:8082',
          description:
            'ë§¤ì… ì™„ë£Œ ê±´ì„ ì¼ë³„ë¡œ ì§‘ê³„í•˜ì—¬ ê°€ë§¹ì  ì •ì‚° ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•´ ë°°ì¹˜ë¡œ ë°ì´í„°ë¥¼ ì ì¬í•©ë‹ˆë‹¤.',
          upstream: 'Consumes Kafka â† payment.captured',
          endpoints: [
            {
              id: 'settlement-health',
              label: 'ì •ì‚° ë°°ì¹˜ ìƒíƒœ',
              method: 'GET',
              path: '/actuator/health',
              scope: 'Observability',
              sampleBody: null,
              notes:
                'ì •ì‚° ì„œë¹„ìŠ¤ê°€ ë³„ë„ í¬íŠ¸(ì˜ˆ: 8082)ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ í—¬ìŠ¤ ì²´í¬ì…ë‹ˆë‹¤.',
            },
          ],
        },
        {
          id: 'notify',
          name: 'Notify Service',
          domain: 'messaging',
          baseUrl: 'http://localhost:8083',
          description:
            'ê³ ê° ë° ìƒì ì—ê²Œ ì•Œë¦¼ì„ ì „ì†¡í•˜ëŠ” ë¹„ë™ê¸° ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. Kafka DLQë¥¼ ê°ì‹œí•˜ê³  ì¬ì²˜ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.',
          upstream: 'Consumes Kafka â† payment.refunded',
          endpoints: [
            {
              id: 'notify-preview',
              label: 'ì•Œë¦¼ ë¯¸ë¦¬ë³´ê¸°',
              method: 'POST',
              path: '/notifications/preview',
              scope: 'Utility',
              sampleBody: {
                channel: 'EMAIL',
                templateId: 'refund-complete',
                payload: {
                  merchantName: 'Sample Shop',
                  amount: 15000,
                  currency: 'KRW',
                },
              },
              notes:
                'ì•„ì§ ë°±ì—”ë“œê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ ìš”ì²­ì€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. êµ¬ì¡°ë§Œ ë¹ ë¥´ê²Œ í™•ì¸í•´ ë³´ì„¸ìš”.',
            },
          ],
        },
      ];

      const prettifyJson = (value) => {
        if (value === null || value === undefined || value === '') {
          return '';
        }
        try {
          return JSON.stringify(typeof value === 'string' ? JSON.parse(value) : value, null, 2);
        } catch (err) {
          return typeof value === 'string' ? value : JSON.stringify(value, null, 2);
        }
      };

      const EndpointTester = ({ service, endpoint }) => {
        const [path, setPath] = useState(endpoint.path);
        const [body, setBody] = useState(prettifyJson(endpoint.sampleBody));
        const [loading, setLoading] = useState(false);
        const [response, setResponse] = useState(null);
        const [error, setError] = useState(null);

        const isBodyAllowed = endpoint.method !== 'GET' && endpoint.method !== 'DELETE';

        const sendRequest = async () => {
          setLoading(true);
          setError(null);
          setResponse(null);

          let parsedBody = null;
          if (isBodyAllowed && body.trim().length > 0) {
            try {
              parsedBody = JSON.parse(body);
            } catch (err) {
              setError('ìš”ì²­ ë³¸ë¬¸ì´ ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
              setLoading(false);
              return;
            }
          }

          try {
            const fetchOptions = {
              method: endpoint.method,
              headers: {},
            };

            if (isBodyAllowed) {
              fetchOptions.headers['Content-Type'] = 'application/json';
              fetchOptions.body = parsedBody ? JSON.stringify(parsedBody) : '{}';
            }

            const url = `${service.baseUrl}${path.startsWith('/') ? '' : '/'}${path}`;
            const result = await fetch(url, fetchOptions);
            const contentType = result.headers.get('content-type') ?? '';
            const rawText = await result.text();
            let parsed = rawText;
            if (contentType.includes('application/json')) {
              try {
                parsed = JSON.parse(rawText);
              } catch (err) {
                parsed = rawText;
              }
            }

            setResponse({
              status: `${result.status} ${result.statusText}`,
              ok: result.ok,
              body: parsed,
            });
          } catch (err) {
            setError(`ìš”ì²­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${err.message}`);
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="endpoint-card">
            <div className="endpoint-header">
              <span className="badge method">{endpoint.method}</span>
              <span className="badge scope">{endpoint.scope}</span>
              <strong>{endpoint.label}</strong>
            </div>
            <input
              className="path-input"
              value={path}
              onChange={(event) => setPath(event.target.value)}
              placeholder="/payments/..."
              aria-label="ìš”ì²­ ê²½ë¡œ"
            />
            {isBodyAllowed && (
              <textarea
                value={body}
                onChange={(event) => setBody(event.target.value)}
                spellCheck={false}
                aria-label="ìš”ì²­ ë³¸ë¬¸"
              />
            )}
            <div className="endpoint-footer">
              <button
                className="send-button"
                onClick={sendRequest}
                disabled={loading}
                type="button"
              >
                {loading ? 'ìš”ì²­ ì¤‘â€¦' : 'ìš”ì²­ ë³´ë‚´ê¸°'}
              </button>
              {endpoint.notes && <p className="notes">ğŸ’¡ {endpoint.notes}</p>}
              {error && <p className="notes" style={{ color: '#dc2626' }}>âš ï¸ {error}</p>}
              {response && (
                <div>
                  <div className="status-line">
                    ì‘ë‹µ ìƒíƒœ: <strong>{response.status}</strong>{' '}
                    {response.ok ? 'âœ…' : 'âŒ'}
                  </div>
                  <pre className="response-viewer">{prettifyJson(response.body)}</pre>
                </div>
              )}
            </div>
          </div>
        );
      };

      const App = () => {
        const [selectedServiceId, setSelectedServiceId] = useState('payment');
        const [overrideBaseUrl, setOverrideBaseUrl] = useState('');

        const selectedService = useMemo(() => {
          const service = SERVICE_CATALOG.find((service) => service.id === selectedServiceId);
          if (!service) {
            return null;
          }
          if (!overrideBaseUrl.trim()) {
            return service;
          }
          return {
            ...service,
            baseUrl: overrideBaseUrl.trim().replace(/\/$/, ''),
          };
        }, [selectedServiceId, overrideBaseUrl]);

        return (
          <>
            <header>
              <h1>ê²°ì œ MSA í…ŒìŠ¤íŠ¸ ì½˜ì†”</h1>
              <p>
                Gradleë¡œ ì‹¤í–‰í•œ ë°±ì—”ë“œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì„ ì†ì‰½ê²Œ ì ê²€í•˜ê¸° ìœ„í•œ React ê¸°ë°˜ íˆ´ì…ë‹ˆë‹¤.
                ì„œë¹„ìŠ¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ê³  ê° ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•´ ë³´ì„¸ìš”.
              </p>
            </header>

            <section className="service-grid">
              {SERVICE_CATALOG.map((service) => (
                <article
                  key={service.id}
                  className={`service-card ${selectedServiceId === service.id ? 'active' : ''}`}
                  onClick={() => setSelectedServiceId(service.id)}
                >
                  <div className="service-meta">
                    <span>{service.domain}</span>
                  </div>
                  <h2>{service.name}</h2>
                  <p className="service-description">{service.description}</p>
                  <p className="service-upstream">{service.upstream}</p>
                  <p className="service-upstream" style={{ fontWeight: 600 }}>
                    ê¸°ë³¸ URL: {service.baseUrl}
                  </p>
                </article>
              ))}
            </section>

            {selectedService && (
              <section className="panel" aria-live="polite">
                <div className="env-bar">
                  <h3>{selectedService.name} ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</h3>
                  <label>
                    ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ URL
                    <input
                      className="env-input"
                      value={overrideBaseUrl}
                      onChange={(event) => setOverrideBaseUrl(event.target.value)}
                      placeholder={`${selectedService.baseUrl}`}
                    />
                  </label>
                </div>
                <div className="endpoints">
                  {selectedService.endpoints.map((endpoint) => (
                    <EndpointTester
                      key={endpoint.id}
                      service={selectedService}
                      endpoint={endpoint}
                    />
                  ))}
                </div>
              </section>
            )}
          </>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
